# 游댏 CONFIGURACI칍N DE POL칈TICAS DE RED - SISTEMA SENTINEL
# 丘멆잺  CONFIGURACI칍N CR칈TICA DE SEGURIDAD

# =============================================================================
# POL칈TICAS DE RED RESTRICTIVAS
# =============================================================================

# 1. PUERTOS PERMITIDOS (SOLO LO NECESARIO)
ALLOWED_PORTS = {
    "8001": "persistence_service",      # Solo localhost
    "8002": "classification_service",   # Solo localhost  
    "6379": "redis",                    # Solo localhost, con password
    "5555": "flower",                   # Solo localhost, con auth
    "5678": "n8n"                       # Solo localhost, con auth
}

# 2. OR칈GENES PERMITIDOS
ALLOWED_ORIGINS = [
    "http://localhost:5678",            # n8n local
    "http://127.0.0.1:5678",           # n8n local alternativo
    "http://localhost:8001",            # persistence service
    "http://127.0.0.1:8001",           # persistence service alternativo
]

# 3. PROTOCOLOS PERMITIDOS
ALLOWED_PROTOCOLS = ["http", "https"]

# 4. HEADERS DE SEGURIDAD OBLIGATORIOS
REQUIRED_SECURITY_HEADERS = [
    "X-Correlation-ID",                 # Para auditor칤a
    "Authorization",                    # Para autenticaci칩n
    "Content-Type",                     # Para validaci칩n
]

# 5. M칄TODOS HTTP PERMITIDOS
ALLOWED_HTTP_METHODS = ["GET", "POST", "PUT", "DELETE"]

# 6. TAMA칌OS M츼XIMOS DE REQUEST
MAX_REQUEST_SIZES = {
    "default": "10MB",
    "file_upload": "50MB",
    "api_request": "1MB"
}

# 7. RATE LIMITING POR ENDPOINT
RATE_LIMITS = {
    "health": "30/minute",              # Endpoints p칰blicos
    "classify": "10/minute",            # Operaciones pesadas
    "status": "100/minute",             # Consultas de estado
    "upload": "5/minute"                # Subida de archivos
}

# 8. BLACKLIST DE IPs (si es necesario)
BLOCKED_IPS = [
    # Agregar IPs maliciosas conocidas
]

# 9. WHITELIST DE IPs (en producci칩n)
ALLOWED_IPS = [
    "127.0.0.1",                       # Localhost
    "::1",                             # IPv6 localhost
    # Agregar IPs de confianza en producci칩n
]

# 10. CONFIGURACI칍N DE FIREWALL
FIREWALL_RULES = {
    "default_policy": "DROP",           # Pol칤tica por defecto: rechazar todo
    "established_connections": "ACCEPT", # Permitir conexiones establecidas
    "loopback": "ACCEPT",               # Permitir tr치fico local
    "invalid_packets": "DROP",          # Rechazar paquetes inv치lidos
    "syn_flood_protection": "ENABLED",  # Protecci칩n contra SYN flood
    "icmp_echo": "DROP",                # Bloquear ping
    "fragment_reassembly": "DROP"       # Bloquear fragmentos
}

# 11. LOGGING DE SEGURIDAD DE RED
NETWORK_SECURITY_LOGGING = {
    "enabled": True,
    "log_level": "WARNING",
    "log_events": [
        "connection_attempts",
        "authentication_failures", 
        "rate_limit_violations",
        "suspicious_ips",
        "protocol_violations"
    ]
}

# 12. MONITOREO DE RED
NETWORK_MONITORING = {
    "enabled": True,
    "check_interval": "30s",
    "alerts": [
        "unusual_traffic_patterns",
        "high_connection_rates",
        "authentication_failures",
        "port_scanning_attempts"
    ]
}

# =============================================================================
# IMPLEMENTACI칍N DE POL칈TICAS
# =============================================================================

# Para implementar estas pol칤ticas:

# 1. Docker Compose ya est치 configurado con puertos restringidos a localhost
# 2. FastAPI ya tiene CORS configurado con or칤genes espec칤ficos
# 3. Rate limiting ya est치 implementado con slowapi
# 4. Autenticaci칩n ya est치 implementada con API tokens
# 5. Logging de auditor칤a ya est치 implementado

# =============================================================================
# VERIFICACI칍N DE IMPLEMENTACI칍N
# =============================================================================

# Verificar que las pol칤ticas est칠n activas:
# 1. curl http://localhost:8002/health (debe requerir Authorization header)
# 2. curl http://localhost:6379 (debe requerir password)
# 3. curl http://localhost:5555/flower/ (debe requerir Basic Auth)
# 4. curl http://localhost:5678/ (debe requerir Basic Auth)
# 5. curl -H "Authorization: Bearer invalid_token" http://localhost:8002/health (debe fallar)

# =============================================================================
# ADVERTENCIAS DE SEGURIDAD
# =============================================================================

# 丘멆잺  NO EXPONER PUERTOS A INTERNET SIN HTTPS
# 丘멆잺  NO USAR CONTRASE칌AS D칄BILES
# 丘멆잺  MONITOREAR LOGS DE SEGURIDAD REGULARMENTE
# 丘멆잺  ACTUALIZAR CONTRASE칌AS CADA 90 D칈AS
# 丘멆잺  IMPLEMENTAR HTTPS EN PRODUCCI칍N
# 丘멆잺  CONFIGURAR FIREWALL DEL SISTEMA OPERATIVO
